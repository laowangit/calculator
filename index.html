<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易品种手数计算器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="PositionCalculator.css">
</head>
<body>
    <div class="container py-5">
        <div class="logo">
            <h2>
                交易手数计算器
            </h2>
        </div>
        
        <div class="card">
            <div class="card-header">
                计算交易所需的手数大小
            </div>
            
            <div class="card-body">
                <form id="positionCalculator">
                    <div class="form-group">
                        <label for="tradingSymbol">交易品种类型 *</label>
                        <select class="form-select" id="tradingSymbol" required>
                            <option value="">-- 请选择交易品种类型 --</option>
                            <option value="indirect">间接报价xxxUSD（如EURUSD）</option>
                            <option value="direct">直接报价USDxxx（如USDJPY）</option>
                            <option value="indirect_cross">间接报价交叉盘（如EURGBP）</option>
                            <option value="direct_cross">直接报价交叉盘（如EURJPY）</option>
                            <option value="gold">黄金（XAU/USD）</option>
                            <option value="silver">白银（XAG/USD）</option>
                            <option value="oil">原油</option>
                            <option value="usindex">三大美指（美元指数）</option>
                            <option value="germanindex">德指（DAX）</option>
                            <option value="japanindex">日经（Nikkei）</option>
                            <option value="hkindex">恒指（HSI）</option>
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="entryPrice">开仓价 *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="entryPrice" step="0.00001" placeholder="输入开仓价" required>
                                    <span class="input-group-text">USD</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="stopLoss">止损价 *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="stopLoss" step="0.00001" placeholder="输入止损价" required>
                                    <span class="input-group-text">USD</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="totalCapital">总资金 *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="totalCapital" placeholder="输入总资金金额" required>
                                    <span class="input-group-text">USD</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="stopLossPercent">固定止损比 *</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="stopLossPercent" step="0.1" placeholder="输入止损百分比" required>
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="crossRateField" class="form-group hidden">
                        <label for="crossRate">交叉盘汇率 *</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="crossRate" step="0.00001" placeholder="输入交叉盘汇率">
                            <span class="input-group-text">USD</span>
                        </div>
                    </div>
                    
                    <div id="contractSizeField" class="form-group hidden">
                        <label for="contractSize">1手合约量 *</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="contractSize" placeholder="输入1手合约量">
                            <span class="input-group-text">单位</span>
                        </div>
                    </div>
                    
                    <div id="marginRateField" class="form-group hidden">
                        <label for="marginRate">预付款货币汇率 *</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="marginRate" step="0.00001" placeholder="输入预付款货币汇率">
                            <span class="input-group-text">USD</span>
                        </div>
                    </div>
                    
                    <button type="button" id="calculateBtn" class="btn btn-calculate btn-lg">计算手数大小</button>
                    
                    <div id="resultSection" class="result-container hidden">
                        <div class="text-center">
                            <h5>推荐的手数大小为：</h5>
                            <div class="result-value" id="positionSizeResult">--</div>
                            <p class="mt-2"><small>单位：标准手</small></p>
                        </div>
                    </div>
                </form>
                
                <div class="explanation">
                    <h5>交易品种类型说明</h5>
                    <ul>
                        <li><strong>间接报价（如EURUSD）</strong> - 表示基础货币是其他货币，报价货币为美元</li>
                        <li><strong>直接报价（如USDJPY）</strong> - 表示基础货币是美元，报价货币为其他货币</li>
                        <li><strong>交叉盘</strong> - 涉及两种非美元货币的交易对，需要提供交叉盘汇率(报价货币与美元之间的汇率)</li>
                        <li><strong>贵金属（黄金/白银）</strong> - 以美元计价的贵金属交易</li>
                        <li><strong>指数交易</strong> - 包括原油、美元指数、德指、日经和恒指等品种</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2025 交易手数计算器 | 专业金融工具</p>
            <p><small>注意：此计算结果仅供交易参考，请根据自身风险承受能力进行交易决策</small></p>
        </footer>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#totalCapital').val('10000');
            $('#stopLossPercent').val('2');

            $('#tradingSymbol').change(function() {

                $('#entryPrice, #stopLoss').val('');
                $('#crossRate, #contractSize, #marginRate').val('');
                
                $('#totalCapital').val('10000');
                $('#stopLossPercent').val('2');

                $('#resultSection').addClass('hidden');

                const selectedValue = $(this).val();
                
                $('#crossRateField, #contractSizeField, #marginRateField').addClass('hidden');
                
                if (selectedValue === 'indirect_cross' || selectedValue === 'direct_cross') {
                    $('#crossRateField').removeClass('hidden');
                }
                
                const contractSizeTypes = ['oil', 'usindex', 'germanindex', 'japanindex', 'hkindex'];
                if (contractSizeTypes.includes(selectedValue)) {
                    $('#contractSizeField').removeClass('hidden');
                }
                
                const marginRateTypes = ['germanindex', 'japanindex', 'hkindex'];
                if (marginRateTypes.includes(selectedValue)) {
                    $('#marginRateField').removeClass('hidden');
                }
                
                $('#resultSection').addClass('hidden');
            });
            
            $('#calculateBtn').click(function() {
                if (!$('#positionCalculator')[0].checkValidity()) {
                    alert('请填写所有必填字段！');
                    return;
                }

                const tradeType = $('#tradingSymbol').val();
                const entryPrice = parseFloat($('#entryPrice').val());
                const stopLoss = parseFloat($('#stopLoss').val());
                const totalCapital = parseFloat($('#totalCapital').val());
                const stopLossPercent = parseFloat($('#stopLossPercent').val());
                const crossRate = $('#crossRateField').is(':visible') ? parseFloat($('#crossRate').val()) : null;
                const contractSize = $('#contractSizeField').is(':visible') ? parseFloat($('#contractSize').val()) : null;
                const marginRate = $('#marginRateField').is(':visible') ? parseFloat($('#marginRate').val()) : null;
                
                let riskAmount = totalCapital * (stopLossPercent / 100);
                let pointsRisk = Math.abs(entryPrice - stopLoss);
                let positionSize;
                switch(tradeType){
                    case 'indirect':
                        positionSize = riskAmount / (pointsRisk * 100000)
                        break;
                    case 'direct':
                        positionSize = riskAmount * entryPrice / (pointsRisk * 100000)
                        break;
                    case 'indirect_cross':
                        positionSize = riskAmount / (pointsRisk * 100000 * crossRate)
                        break;
                    case 'direct_cross':
                        positionSize = riskAmount * crossRate / (pointsRisk * 100000)
                        break;
                    case 'gold':
                        positionSize = riskAmount / (pointsRisk * 100)
                        break;
                    case 'silver':
                        positionSize = riskAmount / (pointsRisk * 5000)
                        break;
                    case 'oil':
                        positionSize = riskAmount / (pointsRisk * contractSize)
                        break;
                    case 'usindex':
                        positionSize = riskAmount / (pointsRisk * contractSize)
                        break;
                    case 'germanindex':
                        positionSize = riskAmount / (pointsRisk * contractSize * marginRate)
                        break;
                    case 'japanindex':
                        positionSize = riskAmount * marginRate / (pointsRisk * contractSize)
                        break;
                    case 'hkindex':
                        positionSize = riskAmount * marginRate / (pointsRisk * contractSize)
                        break;
                }

                $('#resultSection').removeClass('hidden');
                
                const displayValue = positionSize.toFixed(2);
                
                $('#positionSizeResult').text(displayValue);
            });
        });
    </script>
</body>

</html>
